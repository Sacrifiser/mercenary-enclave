# These effects are only used by the fleet mission type

fmerc_ops_ensure_all_event_targets = {
	fmerc_set_buyer = yes
	fmerc_set_hq = yes
	fmerc_set_target_country = yes
	if = {
		limit = {
			exists = event_target:fmerc_target_country
			NOT = { exists = event_target:fmerc_target }
			event_target:fmerc_target_country = {
				any_owned_ship = {
					exists = fleet
					has_ship_flag = "fmerc_target"
				}
			}
		}
		# If our fleet exists, we first try to find a target within the system it's in.
		if = {
			limit = {
				exists = event_target:fmerc_ops_fleet
				event_target:fmerc_ops_fleet = {
					exists = solar_system
				}
			}
			event_target:fmerc_target_country = {
				random_owned_ship = {
					limit = {
						exists = fleet
						has_ship_flag = "fmerc_target"
						exists = solar_system
						solar_system = {
							is_same_value = event_target:fmerc_ops_fleet.solar_system
						}
					}
					fleet = {
						save_event_target_as = fmerc_target
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					exists = event_target:fmerc_target
				}
			}
			event_target:fmerc_target_country = {
				random_owned_ship = {
					limit = {
						exists = fleet
						has_ship_flag = "fmerc_target"
					}
					fleet = {
						save_event_target_as = fmerc_target
					}
				}
			}
		}
	}
	if = {
		limit = {
			NOT = { exists = event_target:fmerc_ops_fleet }
			any_owned_fleet = {
				has_fleet_flag = "fmerc_raiding_fleet"
			}
		}
		random_owned_fleet = {
			limit = {
				has_fleet_flag = "fmerc_raiding_fleet"
			}
			save_event_target_as = fmerc_ops_fleet
		}
	}
}
